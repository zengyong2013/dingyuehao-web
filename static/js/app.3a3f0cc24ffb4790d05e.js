webpackJsonp([1],{"4jXL":function(t,e){},Kujk:function(t,e){},NCk4:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("7+uW"),i=a("Dd8w"),s=a.n(i),r=a("NYxO"),o=a("Xxa5"),c=a.n(o),u=a("exGp"),d=a.n(u),v=a("Zrlr"),l=a.n(v),h=a("wxAW"),f=a.n(h),m=a("mtWM"),p=a.n(m).a.create({baseURL:"http://localhost/activity-server/public/web",timeout:5e3}),_=new(function(){function t(){l()(this,t)}return f()(t,[{key:"getUser",value:function(t){return p({url:"user/add",method:"post",data:t})}},{key:"storyAdd",value:function(t){return p({url:"story/add",method:"post",data:t})}},{key:"storyGet",value:function(t){return p({url:"story/get",method:"post",data:t})}},{key:"storyMatch",value:function(t){return p({url:"story/match",method:"post",data:t})}},{key:"activityGet",value:function(t){return p({url:"activity/get",method:"post",data:t})}}]),t}()),y={name:"Add",components:{},data:function(){return{storyData:{nickName:"",content:"",userId:"",activityId:""}}},computed:s()({},Object(r.b)({activity:function(t){return t.app.activity},userId:function(t){return t.app.userInfo.id}})),watch:{"storyData.content":function(t){t.length>140&&(this.storyData.content=this.storyData.content.substr(0,140))},"storyData.nickName":function(t){t.length>5&&(this.storyData.nickName=this.storyData.nickName.substr(0,5))}},methods:{ajax:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.$emit("show-loading","正在提交，请稍后..."),_[t](a).then(function(t){e.$emit("hide-loading");var a=t.data;return 0===a.code?a.data||!0:(e.$emit("show-loading",a.msg,2e3),!1)}).catch(function(){return e.$emit("show-loading","请求失败，请重试",2e3),!1})},addStory:function(){var t=this;return d()(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.storyData.userId=t.userId,t.storyData.activityId=t.activity.id,t.storyData.nickName&&t.storyData.content){e.next=5;break}return t.$emit("show-loading","请输入完整内容",2e3),e.abrupt("return");case 5:return e.next=7,t.ajax("storyAdd",t.storyData);case 7:e.sent&&t.$store.dispatch("setHasStory",t.activity.code);case 9:case"end":return e.stop()}},e,t)}))()}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main"},[a("div",{staticClass:"text",domProps:{innerHTML:t._s(t.activity.content_start.replace(/\n/g,"<br/>"))}}),t._v(" "),a("div",{staticClass:"content relative"},[a("div",{staticClass:"border-top"}),t._v(" "),a("div",{staticClass:"arrow-right"}),t._v(" "),a("div",{staticClass:"count"},[t._v(t._s(t.storyData.content.length)+"/140")]),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.storyData.content,expression:"storyData.content"}],staticClass:"textarea",attrs:{placeholder:"请在此输入你的故事，140个字符以内"},domProps:{value:t.storyData.content},on:{input:function(e){e.target.composing||t.$set(t.storyData,"content",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"name"},[t._m(0),t._v(" "),a("div",{staticClass:"relative"},[a("div",{staticClass:"border-top"}),t._v(" "),a("div",{staticClass:"arrow-right"}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.storyData.nickName,expression:"storyData.nickName"}],staticClass:"input",attrs:{type:"text",placeholder:"请在此处输入昵称，5个字符以内"},domProps:{value:t.storyData.nickName},on:{input:function(e){e.target.composing||t.$set(t.storyData,"nickName",e.target.value)}}})])]),t._v(" "),a("div",{staticClass:"btn center"},[a("span",{on:{touchend:t.addStory}})])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",{staticClass:"name-text"},[this._v("你的昵称是？")])])}]};var C=a("VU/8")(y,g,!1,function(t){a("rK1P")},"data-v-ffbd21e0",null).exports,w={name:"Show",components:{},data:function(){return{storyDetail:{otherStory:{content:""}}}},computed:s()({},Object(r.b)({activity:function(t){return t.app.activity},userId:function(t){return t.app.userInfo.id}})),mounted:function(){var t=this;return d()(c.a.mark(function e(){var a,n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={userId:t.userId,activityId:t.activity.id},e.next=3,t.ajax("storyMatch",a);case 3:(n=e.sent)&&(t.storyDetail=n);case 5:case"end":return e.stop()}},e,t)}))()},methods:{ajax:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _[t](a).then(function(t){var a=t.data;return 0===a.code?a.data||!0:(e.$emit("show-loading",a.msg,2e3),!1)}).catch(function(){return e.$emit("show-loading","数据获取失败",2e3),!1})}}},x={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main"},[a("div",{staticClass:"text",domProps:{innerHTML:t._s(t.activity.content_end.replace(/\n/g,"<br/>"))}}),t._v(" "),a("div",{staticClass:"name"},[t._m(0),t._v(" "),a("div",{staticClass:"relative"},[a("div",{staticClass:"border-top"}),t._v(" "),a("div",{staticClass:"arrow-right"}),t._v(" "),a("div",{staticClass:"input"},[t._v("\n\t\t\t\t\t"+t._s(t.storyDetail.otherStory.nick_name)+"\n\t\t\t\t")])])]),t._v(" "),a("div",[t._m(1),t._v(" "),a("div",{staticClass:"content relative"},[a("div",{staticClass:"border-top"}),t._v(" "),a("div",{staticClass:"arrow-right"}),t._v(" "),a("div",{staticClass:"textarea",domProps:{innerHTML:t._s(t.storyDetail.otherStory.content.replace(/\n/g,"<br/>"))}})])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",{staticClass:"name-text"},[this._v("TA的昵称")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",{staticClass:"name-text"},[this._v("TA的故事")])])}]};var S=a("VU/8")(w,x,!1,function(t){a("iZ7T")},"data-v-1c2abe97",null).exports,b={name:"Join",components:{},data:function(){return{}},computed:s()({},Object(r.b)({activity:function(t){return t.app.activity}}))},I={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"main"},[e("div",{staticClass:"text",domProps:{innerHTML:this._s(this.activity.content_share.replace(/\n/g,"<br/>"))}}),this._v(" "),this._m(0),this._v(" "),this._m(1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip center"},[e("div",{staticClass:"img"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"qrcode center"},[e("div",{staticClass:"img"})])}]};var T=a("VU/8")(b,I,!1,function(t){a("Vh5z")},"data-v-20e622bd",null).exports,D={name:"Join",components:{},data:function(){return{}},computed:s()({},Object(r.b)({endDateText:function(t){return t.app.activity.end_date_text}})),methods:{share:function(){this.$emit("show-share-guid")}}},$={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main center"},[t._m(0),t._v(" "),a("div",{staticClass:"msg relative"},[a("span",{staticClass:"img"}),t._v(" "),a("div",{staticClass:"msg-text"},[a("p",[t._v("分享完毕后")]),t._v(" "),a("p",[t._v(t._s(t.endDateText)+"将在订阅号“买买菌”")]),t._v(" "),a("p",[t._v("为你公布交换结果")])]),t._v(" "),a("p",{staticClass:"no-share"},[t._v("(如果不分享，本次报名将无效噢)")])]),t._v(" "),a("div",{staticClass:"btn",on:{touchend:t.share}},[a("span",{staticClass:"img"})]),t._v(" "),t._m(1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"success"},[e("span",{staticClass:"img"}),this._v(" "),e("p",[this._v("点击下方分享按钮")]),this._v(" "),e("p",[this._v("完成报名")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tips"},[e("span",{staticClass:"img"})])}]};var k=a("VU/8")(D,$,!1,function(t){a("Kujk")},"data-v-4159014c",null).exports,E={name:"Loading",props:{text:{type:String,default:"数据加载中..."}},data:function(){return{}}},A={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"mock"},[e("div",{staticClass:"main"},[e("span",[this._v(this._s(this.text))])])])},staticRenderFns:[]};var N=a("VU/8")(E,A,!1,function(t){a("4jXL")},"data-v-e88b888a",null).exports,O=a("BO1k"),j=a.n(O);function L(){var t=location.search,e={};if(-1!==t.indexOf("?")){var a=t.substr(1).split("&"),n=!0,i=!1,s=void 0;try{for(var r,o=j()(a);!(n=(r=o.next()).done);n=!0){var c=r.value;e[c.split("=")[0]]=unescape(c.split("=")[1])}}catch(t){i=!0,s=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw s}}}return e}var U={name:"App",components:{Add:C,Show:S,Join:T,Share:k,Loading:N},data:function(){return{loadingText:"数据加载中...",loadingStatus:!1,shareGuid:!1}},computed:s()({},Object(r.b)({activity:function(t){return t.app.activity},userInfo:function(t){return t.app.userInfo},hasStory:function(t){return t.app.hasStory}}),{currentView:function(){var t=L();return this.activity.finish?this.userInfo?"Show":"Add":this.hasStory?("share"!=t.action&&(location.href=location.href+"&action=share"),"Share"):"share"==t.action?"Join":"Add"}}),mounted:function(){navigator.userAgent.indexOf("micromessenger");this.$store.dispatch("setUserInfo");var t=L();t.code&&(this.$store.dispatch("setActivity",t.code),this.$store.dispatch("setHasStory",t.code))},methods:{showLoading:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"数据加载中...",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.loadingText=e,this.loadingStatus=!0,a>0&&window.setTimeout(function(){t.loadingStatus=!1},a)},hideLoading:function(){this.loadingStatus=!1}}},H={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[t.activity&&t.userInfo?a("div",{staticClass:"banner"},[a("img",{attrs:{width:"100%",src:t.activity.banner}})]):t._e(),t._v(" "),t.activity&&t.userInfo?a("div",{staticStyle:{height:"100%"}},[a(t.currentView,{tag:"component",on:{"show-loading":t.showLoading,"hide-loading":t.hideLoading,"show-share-guid":function(e){t.shareGuid=!0}}})],1):t._e(),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.loadingStatus||!t.activity||!t.userInfo,expression:"loadingStatus || (!activity || !userInfo)"}],staticClass:"loading"},[a("Loading",{attrs:{text:t.loadingText}})],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.shareGuid,expression:"shareGuid"}],staticClass:"share-guid",on:{touchend:function(e){t.shareGuid=!1}}},[a("div",{staticClass:"img"})])])},staticRenderFns:[]};var R=a("VU/8")(U,H,!1,function(t){a("NCk4"),a("Occx")},"data-v-310beb32",null).exports,V={state:{activity:null,userInfo:null,hasStory:!1},mutations:{SET_ACTIVITY:function(t,e){t.activity=e},SET_USER_INFO:function(t,e){t.userInfo=e},SET_HAS_STORY:function(t,e){t.hasStory=e}},actions:{setActivity:function(t,e){var a=t.commit,n={code:e};return _.activityGet(n).then(function(t){return 0===t.data.code&&(a("SET_ACTIVITY",t.data.data),!0)}).catch(function(){return!1})},setUserInfo:function(t){var e=t.commit,a={userId:window.localStorage.userId};return _.getUser(a).then(function(t){if(0===t.data.code){var a=t.data.data;return window.localStorage.userId=a.id,e("SET_USER_INFO",a),!0}return!1}).catch(function(){return!1})},setHasStory:function(t,e){var a=t.commit,n=window.localStorage.userId;if(n){var i={userId:n,code:e};return _.storyGet(i).then(function(t){return 0===t.data.code?(a("SET_HAS_STORY",!0),!0):(a("SET_HAS_STORY",!1),!0)}).catch(function(){return!1})}}}};n.a.use(r.a);var G=new r.a.Store({modules:{app:V}});n.a.config.productionTip=!1,new n.a({el:"#app",store:G,components:{App:R},template:"<App/>"})},Occx:function(t,e){},Vh5z:function(t,e){},iZ7T:function(t,e){},rK1P:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.3a3f0cc24ffb4790d05e.js.map